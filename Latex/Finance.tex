% !TEX TS-program = pdflatex
% !TEX encoding = UTF-8 Unicode

% This is a simple template for a LaTeX document using the "article" class.
% See "book", "report", "letter" for other types of document.

\documentclass[8pt]{article} % use larger type; default would be 10pt

\usepackage[utf8]{inputenc} % set input encoding (not needed with XeLaTeX)
\usepackage{bchart}
\usepackage{longtable}
\usepackage{pgfgantt}
\usepackage{calendar} % Use the calendar.sty style
\usepackage{calc}
\usepackage{ifthen}
\usepackage{tkz-base}
\usepackage{pdfpages}
\usepackage{hyperref}
\usepackage{pgfplots}
\usepackage{tkz-kiviat,numprint,fullpage} 
\usepackage{pgfplotstable} 
\usetikzlibrary{arrows}
\usepackage{paralist} % very flexible & customisable lists (eg. enumerate/itemize, etc.)
\usepackage{dcolumn}
\usepackage{booktabs}
\usepackage{lscape}
\usepackage{pgf-pie}
\usepackage{verbatim}
\usepackage{animate}
\usepackage{sfmath}
\usepackage{listings}
\usepackage{xcolor}

\definecolor{codegreen}{rgb}{1,0,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}

%%% Examples of Article customizations
% These packages are optional, depending whether you want the features they provide.
% See the LaTeX Companion or other references for full information.

\usepackage{textcomp}
%\usepackage{hyperref}

%%% PAGE DIMENSIONS
\usepackage{geometry} % to change the page dimensions
\geometry{a4paper} % or letterpaper (US) or a5paper or....
% \geometry{margin=2in} % for example, change the margins to 2 inches all round
% \geometry{landscape} % set up the page for landscape
%   read geometry.pdf for detailed page layout information

\usepackage{graphicx} % support the \includegraphics command and options

% \usepackage[parfill]{parskip} % Activate to begin paragraphs with an empty line rather than an indent

%%% PACKAGES
\usepackage{booktabs} % for much better looking tables
\usepackage{array} % for better arrays (eg matrices) in maths
\usepackage{paralist} % very flexible & customisable lists (eg. enumerate/itemize, etc.)
\usepackage{verbatim} % adds environment for commenting out blocks of text & for better verbatim
\usepackage{subfig} % make it possible to include more than one captioned figure/table in a single float
% These packages are all incorporated in the memoir class to one degree or another...

%%% HEADERS & FOOTERS
\usepackage{fancyhdr} % This should be set AFTER setting up the page geometry
\pagestyle{fancy} % options: empty , plain , fancy
\renewcommand{\headrulewidth}{0pt} % customise the layout...
\lhead{}\chead{}\rhead{}
\lfoot{}\cfoot{\thepage}\rfoot{}

%%% SECTION TITLE APPEARANCE
\usepackage{sectsty}
\allsectionsfont{\sffamily\mdseries\upshape} % (See the fntguide.pdf for font help)
% (This matches ConTeXt defaults)

%%% ToC (table of contents) APPEARANCE
\usepackage[nottoc,notlof,notlot]{tocbibind} % Put the bibliography in the ToC
\usepackage[titles,subfigure]{tocloft} % Alter the style of the Table of Contents
\renewcommand{\cftsecfont}{\rmfamily\mdseries\upshape}
\renewcommand{\cftsecpagefont}{\rmfamily\mdseries\upshape} % No bold!

%%% END Article customizations

%%% The "real" document content comes below...

%\includegraphics[width=.2\textwidth]{Logo.png}

\title{Finance}
\author{\copyright Frederic Kerdraon}
%\date{} % Activate to display a given date or no date (if empty),
         % otherwise the current date is printed 


%\addtobeamertemplate{frametitle}{}{%
%\begin{tikzpicture}[remember picture,overlay]
%\node[anchor=north west,yshift=2pt] at (current page.north west) {\includegraphics[height=0.8cm]{Logo1}};
%\end{tikzpicture}}

\begin{document}
\maketitle
\hspace*{-1cm}\includegraphics[width=.2\textwidth,left]{Logo.png}
%//FK - Here we have a problem
{\footnotesize
\input{period}
}
\tableofcontents

%FK - There is no need for an introduction
%\section{Introduction}

%This document summurizes all the important informations necessary to facilitate things and remove a lot of stress. It's been put together thanks to \LaTeX. This is designed to help make optimal decisions for a not so short lifetime.

{\footnotesize
%Ce n'est pas parceque les choses sont difficiles que nous n'osons pas, c'est parceque nous n'osons pas qu'elles sont difficiles.
}
%\makebox[2\width]{hello}

\newcounter{a}
\newcounter{b}
%----------------------------------------------------------
\newcommand{\slice}[4]{
  \pgfmathparse{0.5*#1+0.5*#2}
  \let\midangle\pgfmathresult

   slice
  \draw[thick,fill=black!10] (0,0) -- (#1:1) arc (#1:#2:1) -- cycle;

   outer label
  \node[label=\midangle:#4] at (\midangle:1) {};

   inner label
  \pgfmathparse{min((#2-#1-10)/110*(-0.3),0)}
  \let\temp\pgfmathresult
  \pgfmathparse{max(\temp,-0.5) + 0.9}
  \let\innerpos\pgfmathresult
  \node at (\midangle:\innerpos) {#3};
}

\lstdefinestyle{mystyle}{
    backgroundcolor=\color{backcolour},
    commentstyle=\color{codegreen},
    keywordstyle=\color{magenta},
    numberstyle=\tiny\color{codegray},
    stringstyle=\color{codepurple},
    basicstyle=\ttfamily\footnotesize,
    breakatwhitespace=false,
    breaklines=true,
    captionpos=b,
    keepspaces=true,
    numbers=left,
    numbersep=5pt,
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    tabsize=2
}

\lstset{style=mystyle}

\section{Management summary}

\subsection{PnL Projections}

%Le nombre de simulations est egal au nombre d'arrangements des targets\\
%Pour 8 target, il devrait y avoir un 8! scenarios\\
%Les scenarios sont ordonnes par facilite de mise en oeuvre min(complexity, cost,etc)\\

\subsubsection{Latex Graph of the scenarios}

Initial parameters for the simulations.\\

%\begin{itemize}
%	\item {\$TotalDrift}
%	\item {\$TotalScenTox}
%	\item {\$TotalScenDebt}
%	\item {\$TotalScenCash}
%	\item {\$TotalScenToxDebt}
%	\item {\$TotalScen = 0}
%\end{itemize}

We apply the scenarios below to see what we get after a few iterations\\

%\begin{itemize}
%	\item {\$Scen}
%	\item {\$Scenario reduction of Toxics by 231}
%	\item {\$Scenario reduction of the Debt by 529*0.4}
%	\item {\$Scenario reduction of the Cash by 755*.5}
%	\item {\$Scenario reduction of the Toxics and Debt by 231+529*.4}
%\end{itemize}

my @Scen = (231,529*.4,755*.5,231+529*.4,1000,700,800,950,750);\\

\begin{itemize}
	\item{The first simulation apply a reduction of the Toxics by 231 euros each month}
	\item{The second scenario apply a reduction of the debt by 40 percent of the 529}
	\item{The third one divide the amount of cash spent by 50 percent}
	\item{The fourth one cumulate the reduction of the toxics by 231 euros with the amount of cash spent reduced by 50 percent}
	\item{The fifth one is a reduction of 1000 euros each month}
	\item{The sifth one is a reduction of 700 euros each month}
	\item{The seventh one is a reduction of 800 euros each month}
	\item{The eighth one is a reduction of 950 euros each month}
	\item{The nineth one is a reduction of 750 euros each month}
\end{itemize}

On the graph we can notice that all the scenarios are positive, as they were built to show how to maximize profit, just by managing the charge, and especially useless charges.\\

%my $Drift = $row->{Drift};
%$NewDrift = $Drift + $NewDrift;
%my $KDrift = $Drift/$Unit;
%$TotalDrift = $TotalDrift + $Drift;
%$TotalScenTox = $TotalDrift + $ScenToxics*$Count;
%$TotalScenDebt = $TotalDrift + $ScenDebt*$Count;
%$TotalScenCash = $TotalDrift + $ScenCash*$Count;
%$TotalScenToxDebt = $TotalDrift + $ScenToxDebt*$Count;

%//FK - Here we have a pb

%Dimensions too large....
This graph is dependant on: \$NUM\_RECORDS\_BALANCE which was set to 1000. When we set it to 10 it works. It's ugly, but it works.\\

We would need to input all the data into the database and read it through Scilab to get a proper graph.
%\input{PnLGraph}

%This one works but gives a huge table
%\input{PnL}

\subsubsection{Barplot}

\input{BarPlotPnl}

We need for each graph a table referencing the perl script, the period and the table used for the data.\\
Below is the beginning of the code generating this graph
\lstinputlisting[language=Octave, firstline=3, lastline=5]{../Perl/readCharges}

%{\footnotesize
%BarPlotPnl
%}
\subsubsection{PnL}
%\input{BarPlotPnL}
%\input{BarPlotPnl}
What is the point in having the same graph twice on the same page?!\\
\lstinputlisting[language=Octave, firstline=3, lastline=5]{../Perl/readCharges}

\subsubsection{Kapital}

%\input{BarPlotPnL}
FK - Here we have a pb that needs to be sorted 
%\input{BarPlotKapital}
\subsubsection{Plot of an example}
\includegraphics[scale=0.3]{Finance.png}}
How is this graph generated? 
\lstinputlisting[language=Octave, firstline=3, lastline=5]{../Perl/readCharges}
%tableae.dat\\
%file.dat\\
%immigration.dat\\
%finance.dat\\
%charges.dat\\
%article_contourtmp0.dat\\
%Surface4_contourtmp0.dat\\
%pgfplots_scatterdata4.dat\\
%assets.dat\\
%chargesKiviat.dat\\
%resourcesKiviat.dat\\

%\subsubsection{Latex example}
%\input{parabola-plot}

%\subsubsection{Latex example}
%\input{tikzdevice-demo}

%\subsubsection{Latex example}
%\input{TimeTable}

%\subsubsection{Latex example}
%\input{Torn Paper}

%\subsubsection{Latex example}
%\input{Weather Table}

%\subsubsection{Latex example}
%\input{Transparent}

\subsubsection{Cashflows over a limit}
\includegraphics[scale=0.6]{../Maths/Vector.png}
\lstinputlisting[language=Octave, firstline=3, lastline=5]{../Perl/readCharges}

The limit is defined by the variable \$MAXCASHFLOW\\
The latest improvements on the scilab knowledge should be useable here to manage the dates properly.\\

%This where science enter the game as here can call scilab and there is no limit at what we could calculate... fascinating!\\
%How do we populate Scilab with Negative numbers where there are Debits and Positive numbers for the Credit
\subsubsection{Cash balance}
\includegraphics[scale=0.6]{Scilab-cashBalance.png}
\lstinputlisting[language=Octave, firstline=3, lastline=5]{../Perl/readCharges}
The moving average is funny and needs to be corrected.\\
%\includepdf[pages={1}]{stockchart.pdf}
%\includepdf[pages={1}]{friedberg.pdf}
%\subsubsection{Surface}
%\input{PnLSurface}

%\subsubsection{Gaussian Curve}

%\includepdf[pages={1}]{GaussianCurve.pdf}
%\input{GaussianCurve}
%Was removed because very uncomplete...

%\subsubsection{Parabola}
%This I beleive should be the logo for the finance document, so that every doc has it's logo now :-)\\
%\includepdf[pages={1}]{parabola-plotpdf}
%\input{parabola-plot}

%\subsubsection{Weather}
%\includepdf[pages={1}]{WeatherTable.pdf}
%\input{WeatherTable2}

%\subsubsection{Map Of The Charges}
%\includepdf[pages={1}]{MapOfTheCharges.pdf}
%\input{MapOfTheCharges}

\subsubsection{Pnl over time}
\input{PnL}
\lstinputlisting[language=Octave, firstline=3, lastline=5]{../Perl/readCharges}

All the figures need to be checked carefully by someone who knows what it's doing.\\
We print only the last 10 PnL meaesures (Need to add a variable for that limit)\\
The first column can be reduced to the PnL as the other ficures appear in the table. Also a limit for this table size should be defined as there could be thousands of scenarios.\\

\subsection{History and extrapolations}

\subsubsection{Kapital curve}
%Kapital trend,Assets trend,Liabilities trend,Leverage trend\\
\input{kapitalCurve}
\lstinputlisting[language=Octave, firstline=3, lastline=5]{../Perl/readCharges}

This is the kapitalCurve from perl\\ Doesn't work at the moment...\\

\subsubsection{PnL curve}
\input{pnlCurve}
\lstinputlisting[language=Octave, firstline=3, lastline=5]{../Perl/readCharges}
This is the pnlCurve from perl. Doesn't seem to be working?! What is it supposed to show?\\
%\input{kapitalCurve}

\subsubsection{Cash curve}

Funny cashflow/kapital superior to percent\\

\input{cashCurve}
\lstinputlisting[language=Octave, firstline=3, lastline=5]{../Perl/readCharges}

This is the cashCurve from perl\\
%Checklists.tex:%\includegraphics[scale=0.5]{stockchart.pdf}}

\subsubsection{Cash curve from Scilab man!}
\includegraphics[scale=0.6]{Scilab-cashBalance.png}
\lstinputlisting[language=Octave, firstline=3, lastline=5]{../Perl/readCharges}

This is the cashBalance from Scilab\\

\section{Cash Balance Management}

\subsection{Monthly drift}

\subsubsection{Monthly drift table}
%\input{almGraph}
\input{cashCurve}
\lstinputlisting[language=Octave, firstline=3, lastline=5]{../Perl/readCharges}

\subsubsection{Table of the PnL}
\input{drift}
\lstinputlisting[language=Octave, firstline=3, lastline=5]{../Perl/readCharges}
There is a bug in the table that could be corrected quickly.\\
To be able to have data for the drift, you need to build a C++ insert like for the kapital
go through the dates in the cashflows, and calculate a drift based on this (modulo the salary) 
\subsubsection{Graph}
%\includegraphics[width=.8\textwidth]{PnL.png}
%\input{driftGraph}
%\input{Plot}
\input{cashCurve}
\lstinputlisting[language=Octave, firstline=3, lastline=5]{../Perl/readCharges}
\subsection{Incomes}
%\input{period}

\subsubsection{Income table}
\input{incomes}
\lstinputlisting[language=Octave, firstline=3, lastline=5]{../Perl/readCharges}
\subsubsection{Income graph}
\input{incomesGraph}
\lstinputlisting[language=Octave, firstline=3, lastline=5]{../Perl/readCharges}
\subsubsection{Income Chart}
\input{incomeCurve}
\lstinputlisting[language=Octave, firstline=3, lastline=5]{../Perl/readCharges}
There should be the period as for all the other graphs...\\
%\includegraphics[width=.8\textwidth]{Income.png}

\subsection{Charges}
\input{chargesCurve}
\lstinputlisting[language=Octave, firstline=3, lastline=5]{../Perl/readCharges}
There should be the period as for all the other graphs...\\

\subsubsection{Charges plot}
%Removed to preserve my eyes from the colors....!!!!\\
\includegraphics[scale=0.45]{Charges.png}
\lstinputlisting[language=Octave, firstline=3, lastline=5]{../Perl/readCharges}
It would be interesting to understand the period used to draw this graph.\\
There should be the period as for all the other graphs...\\

\subsubsection{Charges Scilab}
%Removed to preserve my eyes from the colors....!!!!\\
\begin{figure}
\begin{center}
%\centerline{\includegraphics[scale=0.8]{../Maths/Scilab-categories.png}}
\includegraphics[scale=0.8]{../Maths/Scilab-categories.png}
\lstinputlisting[language=Octave, firstline=3, lastline=5]{../Perl/readCharges}
\end{center}
\end{figure}

\subsubsection{Charges kiviat}
%One note :-) This should be random!
\input{chargesKiviat}
\lstinputlisting[language=Octave, firstline=3, lastline=5]{../Perl/readCharges}
There should be the period as for all the other graphs...\\

\subsubsection{Table}
\input{charges}
\lstinputlisting[language=Octave, firstline=3, lastline=5]{../Perl/readCharges}

\subsubsection{Graph}
\input{chargesGraph}
\lstinputlisting[language=Octave, firstline=3, lastline=5]{../Perl/readCharges}
There should be the period as for all the other graphs...\\

\subsubsection{Chart}
What are we supposed to see here?!\\

\subsubsection{Cheese}
\input{chargesCheese}
\lstinputlisting[language=Octave, firstline=3, lastline=5]{../Perl/readCharges}
Here there are a couple of changes that need to be made, starting from the colors of the graph.\\
\section{Asset Liability Management}

\subsection{Kapital}

\subsubsection{Table}
History of the Kapital is available in the database (select * from kapital)\\
Where is the table?!\\

%$\lim_{x \to \infty} \exp(-x) = 0$
%$\lim_{x \to \infty} \exp(-x) = 0$
%K: Kapital\\
%A: Assets\\
%L: Liabilities\\
%K = A-L\\
%L = K/L\\

\subsubsection{Graph}
A graph of the kapital and not income and charges cumulated should be easy to build.
Say a readKapital which would select the cash balance + all the other stuff like assets - liabilities
Better do it with Latex than with the C++ 

\subsubsection{History}
{\footnotesize
Historical graph of the kapital, liab and assets, yearly ALM management\\
%\includegraphics[width=.8\textwidth]{Assets.png}
}

\subsubsection{Definitions}
{\footnotesize
Vp: value weight (basically the value of the asset against the total value - to be replaced by InitPrice)\\
Rp: return weight (the return compared to the total returns)\\
Cp: cost weight (the maintenance cost compared to the total maintenance\\
Vd: historical deprecation of value (the Value compared to the InitPrice\\
R/V: monthly rentability (the return minus the maintenance)\\}

\subsubsection{Ratios}
{\footnotesize
Vp = value/Totalvalue\\
Rp = return/Totalreturn\\
Cp = cost/Totalmaintenance\\
Vd = value/Initprice\\
R/V = return/Value\\}

\subsubsection{Formulas}

{\footnotesize
$\lim_{x \to \infty} \exp(-x) = 0$\\
}

\subsection{Assets}

\subsubsection{Data}
The top 5 assets are listed sorted by value, but the totals are given for all the assets as of today\\
%I KNOW THERE ARE SOME FUNNY NUMBERS!!!\\

\input{assets}
\lstinputlisting[language=Octave, firstline=3, lastline=5]{../Perl/readCharges}
The table should be simplified, it's too big...\\

\subsubsection{Graph}
\input{assetsGraph};
\lstinputlisting[language=Octave, firstline=3, lastline=5]{../Perl/readCharges}

\subsubsection{Cheese}
\input{assetsCheese}
\lstinputlisting[language=Octave, firstline=3, lastline=5]{../Perl/readCharges}

\subsubsection{Kiviat}
\input{assetsKiviat}
\lstinputlisting[language=Octave, firstline=3, lastline=5]{../Perl/readCharges}
Seems like the assets Cheese, I think it's useless in this context.\\ 

\subsection{Liabilities}
The top 4 liabilities are listed but the totals are given for all the liabilities\\

\subsubsection{Table}
\input{liabilities}
\lstinputlisting[language=Octave, firstline=3, lastline=5]{../Perl/readCharges}
The table should be simplified, it's too big...\\
\subsubsection{Graph}
\input{liabilitiesGraph}
\lstinputlisting[language=Octave, firstline=3, lastline=5]{../Perl/readCharges}
\subsubsection{Chart}
%\includegraphics[width=.8\textwidth]{Liabilities.png}
What is it supposed to show?!\\
\subsubsection{Cheese}
\input{liabilitiesCheese}
\lstinputlisting[language=Octave, firstline=3, lastline=5]{../Perl/readCharges}

\section{Cashflows}

%\subsection{Management summary}

All cashflows from history are being used here\\

\subsubsection{Table}
\input{cashflows}
\lstinputlisting[language=Octave, firstline=3, lastline=5]{../Perl/readCharges}
\subsubsection{Graph}
%\input{cashflowsGraph}
It should be feasible to plot a graph of the cashflows aggregated by month with Scilab.
\section{Currencies}

%\subsection{Management summary}

%All stocks and the evolution of their stock price are shown here\\
\includegraphics[scale=0.6]{Scilab-currencies.png}
\lstinputlisting[language=Octave, firstline=3, lastline=5]{../Perl/readCharges}
This is the graph of the EUR/GBP 

\section{Cash balance}
\includegraphics[scale=0.6]{Scilab-cashBalance.png}
\lstinputlisting[language=Octave, firstline=3, lastline=5]{../Perl/readCharges}
This is the graph of my EUR cashbalance 

\section{Stocks}
\includegraphics[scale=0.6]{Scilab-stocks.png}
\lstinputlisting[language=Octave, firstline=3, lastline=5]{../Perl/readCharges}
This is the graph of HSBC stock 

\subsubsection{Table}
Stocks table is available in the database ;-)
select * from stocks
%\input{cashflows}
\subsubsection{Graph}
The graph is also available and produced by C++ under "legends"
\input{cashflowsGraph}
\lstinputlisting[language=Octave, firstline=3, lastline=5]{../Perl/readCharges}
%\includepdf[pages={1}]{stockchart.pdf}

\end{document}

